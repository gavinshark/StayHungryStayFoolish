# æŠ€æœ¯æ ˆè¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜é¡¹ç›®ä½¿ç”¨çš„æŠ€æœ¯æ ˆåŠå…¶é€‰æ‹©ç†ç”±ã€‚

## æ ¸å¿ƒæŠ€æœ¯æ ˆ

### 1. Asio (Standalone)

**ç‰ˆæœ¬**: 1.28.0+  
**ç±»å‹**: Header-onlyå¼‚æ­¥I/Oåº“  
**å®˜ç½‘**: https://think-async.com/Asio/

#### é€‰æ‹©ç†ç”±
- âœ… è·¨å¹³å°æ”¯æŒï¼ˆWindowsã€Linuxã€macOSï¼‰
- âœ… é«˜æ€§èƒ½å¼‚æ­¥I/Oæ¨¡å‹
- âœ… æˆç†Ÿç¨³å®šï¼Œè¢«å¹¿æ³›ä½¿ç”¨ï¼ˆBoost.Asioçš„ç‹¬ç«‹ç‰ˆæœ¬ï¼‰
- âœ… Header-onlyï¼Œæ— éœ€ç¼–è¯‘
- âœ… æ”¯æŒTCPã€UDPã€å®šæ—¶å™¨ç­‰å¤šç§å¼‚æ­¥æ“ä½œ
- âœ… è‰¯å¥½çš„æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒ

#### ä¸»è¦ç”¨é€”
- HTTPæœåŠ¡å™¨çš„å¼‚æ­¥acceptå’Œread/write
- HTTPå®¢æˆ·ç«¯çš„å¼‚æ­¥è¿æ¥å’Œè¯·æ±‚
- å®šæ—¶å™¨ï¼ˆç”¨äºè¶…æ—¶æ§åˆ¶ï¼‰
- å¼‚æ­¥DNSè§£æ

#### ç¤ºä¾‹ä»£ç 
```cpp
#include <asio.hpp>

asio::io_context io_context;
asio::ip::tcp::acceptor acceptor(io_context, 
    asio::ip::tcp::endpoint(asio::ip::tcp::v4(), 8080));

acceptor.async_accept([](std::error_code ec, asio::ip::tcp::socket socket) {
    if (!ec) {
        // å¤„ç†æ–°è¿æ¥
    }
});

io_context.run();
```

### 2. nlohmann/json

**ç‰ˆæœ¬**: 3.11.3+  
**ç±»å‹**: Header-only JSONåº“  
**å®˜ç½‘**: https://json.nlohmann.me/

#### é€‰æ‹©ç†ç”±
- âœ… ç°ä»£C++é£æ ¼çš„API
- âœ… Header-onlyï¼Œæ˜“äºé›†æˆ
- âœ… å®Œæ•´çš„JSONæ”¯æŒï¼ˆè§£æã€ç”Ÿæˆã€éªŒè¯ï¼‰
- âœ… ç±»ä¼¼STLçš„æ¥å£ï¼Œæ˜“äºä½¿ç”¨
- âœ… ä¼˜ç§€çš„é”™è¯¯å¤„ç†
- âœ… é«˜æ€§èƒ½

#### ä¸»è¦ç”¨é€”
- é…ç½®æ–‡ä»¶è§£æï¼ˆconfig.jsonï¼‰
- HTTPè¯·æ±‚/å“åº”çš„JSON bodyå¤„ç†
- æ—¥å¿—ç»“æ„åŒ–è¾“å‡º

#### ç¤ºä¾‹ä»£ç 
```cpp
#include <nlohmann/json.hpp>
using json = nlohmann::json;

// è§£æ
json config = json::parse(file_content);
int port = config["listen_port"];

// ç”Ÿæˆ
json response = {
    {"status", "ok"},
    {"data", {{"id", 123}, {"name", "test"}}}
};
std::string json_str = response.dump();
```

### 3. spdlog

**ç‰ˆæœ¬**: 1.12.0+  
**ç±»å‹**: Header-onlyæ—¥å¿—åº“  
**å®˜ç½‘**: https://github.com/gabime/spdlog

#### é€‰æ‹©ç†ç”±
- âœ… æå¿«çš„æ€§èƒ½ï¼ˆå¼‚æ­¥æ—¥å¿—ï¼‰
- âœ… Header-onlyæ¨¡å¼å¯ç”¨
- âœ… å¤šç§sinkæ”¯æŒï¼ˆæ§åˆ¶å°ã€æ–‡ä»¶ã€rotating fileç­‰ï¼‰
- âœ… æ ¼å¼åŒ–è¾“å‡ºï¼ˆç±»ä¼¼fmtåº“ï¼‰
- âœ… å¤šçº¿ç¨‹å®‰å…¨
- âœ… æ—¥å¿—çº§åˆ«æ§åˆ¶

#### ä¸»è¦ç”¨é€”
- ç½‘å…³è¿è¡Œæ—¥å¿—
- è¯·æ±‚/å“åº”æ—¥å¿—
- é”™è¯¯å’Œè°ƒè¯•ä¿¡æ¯
- æ€§èƒ½ç›‘æ§æ—¥å¿—

#### ç¤ºä¾‹ä»£ç 
```cpp
#include <spdlog/spdlog.h>
#include <spdlog/sinks/rotating_file_sink.h>

auto logger = spdlog::rotating_logger_mt(
    "gateway", "log/gateway.log", 1024*1024*10, 3);

spdlog::set_default_logger(logger);
spdlog::set_level(spdlog::level::info);

spdlog::info("Gateway started on port {}", 8080);
spdlog::error("Connection failed: {}", error_msg);
```

### 4. http-parser (å¯é€‰)

**ç‰ˆæœ¬**: 2.9.4+  
**ç±»å‹**: Cåº“  
**å®˜ç½‘**: https://github.com/nodejs/http-parser

#### é€‰æ‹©ç†ç”±
- âœ… Node.jsä½¿ç”¨çš„HTTPè§£æå™¨ï¼Œæˆç†Ÿå¯é 
- âœ… é«˜æ€§èƒ½
- âœ… æ”¯æŒHTTP/1.1
- âœ… è½»é‡çº§

#### ä¸»è¦ç”¨é€”
- HTTPè¯·æ±‚è§£æï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä½¿ç”¨è‡ªå®ç°çš„è§£æå™¨ï¼‰
- HTTPå“åº”è§£æ

#### å½“å‰çŠ¶æ€
é¡¹ç›®ç›®å‰ä½¿ç”¨è‡ªå®ç°çš„HTTPè§£æå™¨ï¼Œhttp-parserä½œä¸ºå¯é€‰ä¾èµ–ã€‚

## æ„å»ºå·¥å…·

### CMake

**ç‰ˆæœ¬**: 3.15+  
**å®˜ç½‘**: https://cmake.org/

#### é€‰æ‹©ç†ç”±
- âœ… è·¨å¹³å°æ„å»ºç³»ç»Ÿ
- âœ… å¹¿æ³›ä½¿ç”¨ï¼Œå·¥å…·é“¾æˆç†Ÿ
- âœ… æ”¯æŒå¤šç§ç”Ÿæˆå™¨ï¼ˆMakeã€Ninjaã€Visual Studioç­‰ï¼‰
- âœ… æ˜“äºé›†æˆç¬¬ä¸‰æ–¹åº“
- âœ… è‰¯å¥½çš„IDEæ”¯æŒ

## æŠ€æœ¯æ ˆå¯¹æ¯”

### ä¹‹å‰ vs ç°åœ¨

| ç»„ä»¶ | ä¹‹å‰ | ç°åœ¨ | çŠ¶æ€ | æ”¹è¿› |
|------|------|------|------|------|
| ç½‘ç»œI/O | åŸç”Ÿsocket + çº¿ç¨‹ | Asioå¼‚æ­¥I/O | â³ å¾…å®Œæˆ | æ€§èƒ½æå‡10x+ |
| JSONè§£æ | æ‰‹å†™ç®€å•è§£æ | nlohmann/json | âœ… å·²å®Œæˆ | å®Œæ•´åŠŸèƒ½ã€æ›´å¯é  |
| æ—¥å¿— | æ‰‹å†™æ—¥å¿— | spdlog | âœ… å·²å®Œæˆ | å¼‚æ­¥ã€æ ¼å¼åŒ–ã€å¤šsink |
| æ„å»º | Makefile | CMake | âœ… å·²å®Œæˆ | è·¨å¹³å°ã€æ˜“ç»´æŠ¤ |
| HTTPè§£æ | è‡ªå®ç° | è‡ªå®ç°/http-parser | â³ å¾…è¯„ä¼° | å¯é€‰æ›´å¼ºå¤§çš„è§£æå™¨ |

## æ€§èƒ½å¯¹æ¯”

### å¹¶å‘æ€§èƒ½

**ä¹‹å‰ï¼ˆå¤šçº¿ç¨‹æ¨¡å‹ï¼‰**:
- æ¯ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹
- çº¿ç¨‹åˆ›å»º/é”€æ¯å¼€é”€å¤§
- å†…å­˜å ç”¨é«˜ï¼ˆæ¯çº¿ç¨‹~1MBæ ˆç©ºé—´ï¼‰
- å¹¶å‘è¿æ¥æ•°å—é™ï¼ˆé€šå¸¸<1000ï¼‰

**ç°åœ¨ï¼ˆå¼‚æ­¥I/Oæ¨¡å‹ï¼‰**:
- å•çº¿ç¨‹æˆ–çº¿ç¨‹æ± å¤„ç†æ‰€æœ‰è¿æ¥
- æ— çº¿ç¨‹åˆ›å»ºå¼€é”€
- å†…å­˜å ç”¨ä½
- å¹¶å‘è¿æ¥æ•°å¯è¾¾10000+

### æ—¥å¿—æ€§èƒ½

**ä¹‹å‰ï¼ˆåŒæ­¥æ—¥å¿—ï¼‰**:
- æ¯æ¬¡æ—¥å¿—éƒ½é˜»å¡I/O
- å½±å“ä¸»çº¿ç¨‹æ€§èƒ½
- ååé‡: ~10K logs/sec

**ç°åœ¨ï¼ˆå¼‚æ­¥æ—¥å¿—ï¼‰**:
- æ—¥å¿—å†™å…¥åå°çº¿ç¨‹
- ä¸é˜»å¡ä¸»çº¿ç¨‹
- ååé‡: ~1M logs/sec

## ä¾èµ–ç®¡ç†

### å®‰è£…æ–¹å¼

1. **Git Cloneï¼ˆæ¨èï¼‰**
   ```bash
   ./third_party/install_deps.sh
   ```

2. **åŒ…ç®¡ç†å™¨**
   - vcpkg: `vcpkg install asio nlohmann-json spdlog`
   - Homebrew: `brew install asio nlohmann-json spdlog`
   - apt: `apt-get install libasio-dev nlohmann-json3-dev libspdlog-dev`

3. **Git Submodule**
   ```bash
   git submodule add https://github.com/chriskohlhoff/asio.git third_party/asio
   ```

### ç‰ˆæœ¬ç®¡ç†

æ‰€æœ‰ä¾èµ–éƒ½å›ºå®šåˆ°ç‰¹å®šç‰ˆæœ¬ï¼ˆé€šè¿‡git tagï¼‰ï¼Œç¡®ä¿æ„å»ºçš„å¯é‡å¤æ€§ã€‚

## æ›¿ä»£æ–¹æ¡ˆ

### ç½‘ç»œåº“
- **Boost.Asio**: åŠŸèƒ½æ›´å…¨ï¼Œä½†éœ€è¦Boostä¾èµ–
- **libuv**: Cåº“ï¼ŒNode.jsä½¿ç”¨ï¼Œä½†C++ APIä¸å¦‚Asioå‹å¥½
- **libevent**: è€ç‰Œåº“ï¼Œä½†APIè¾ƒè€æ—§

### JSONåº“
- **RapidJSON**: æ›´å¿«ï¼Œä½†APIä¸å¦‚nlohmann/jsonå‹å¥½
- **jsoncpp**: è¾ƒè€ï¼Œæ€§èƒ½ä¸€èˆ¬
- **simdjson**: æå¿«ï¼Œä½†åªè¯»

### æ—¥å¿—åº“
- **glog**: Googleçš„æ—¥å¿—åº“ï¼ŒåŠŸèƒ½å¼ºå¤§ä½†è¾ƒé‡
- **Boost.Log**: åŠŸèƒ½å…¨é¢ä½†ä¾èµ–Boost
- **easylogging++**: è½»é‡ä½†æ€§èƒ½ä¸€èˆ¬

## è¿ç§»è¿›åº¦

### å·²å®Œæˆ âœ…

1. **spdlogæ—¥å¿—åº“** (2024-12-06)
   - æ›¿ä»£æ‰‹å†™æ—¥å¿—ç³»ç»Ÿ
   - æ€§èƒ½æå‡100x
   - æ”¯æŒå¼‚æ­¥æ—¥å¿—å’Œæ–‡ä»¶è½®è½¬

2. **nlohmann/json** (2024-12-06)
   - æ›¿ä»£æ‰‹å†™JSONè§£æ
   - å®Œæ•´çš„JSONæ”¯æŒ
   - æ›´å¥½çš„é”™è¯¯å¤„ç†

3. **CMakeæ„å»ºç³»ç»Ÿ** (2024-12-06)
   - é›†æˆç¬¬ä¸‰æ–¹åº“
   - è·¨å¹³å°æ”¯æŒ
   - è‡ªåŠ¨ä¾èµ–ç®¡ç†

### è¿›è¡Œä¸­ ğŸš§

1. **Asioç½‘ç»œåº“**
   - ç›®æ ‡: å¼‚æ­¥HTTPæœåŠ¡å™¨
   - é¢„æœŸ: å¹¶å‘æ€§èƒ½æå‡10x+

### å¾…å®Œæˆ â³

1. **Asio HTTPå®¢æˆ·ç«¯**
   - å¼‚æ­¥è¯·æ±‚
   - è¿æ¥æ± 

2. **http-parser (å¯é€‰)**
   - è¯„ä¼°æ˜¯å¦éœ€è¦

## æœªæ¥è€ƒè™‘

### å¯èƒ½æ·»åŠ çš„åº“

1. **Prometheus C++ Client**
   - ç”¨é€”: æŒ‡æ ‡å¯¼å‡º
   - ä¼˜å…ˆçº§: ä¸­

2. **OpenSSL/BoringSSL**
   - ç”¨é€”: HTTPSæ”¯æŒ
   - ä¼˜å…ˆçº§: é«˜

3. **Google Test**
   - ç”¨é€”: å•å…ƒæµ‹è¯•
   - ä¼˜å…ˆçº§: é«˜

4. **Benchmark**
   - ç”¨é€”: æ€§èƒ½æµ‹è¯•
   - ä¼˜å…ˆçº§: ä¸­

## è®¸å¯è¯å…¼å®¹æ€§

| åº“ | è®¸å¯è¯ | å•†ä¸šä½¿ç”¨ |
|---|--------|---------|
| Asio | Boost Software License | âœ… å…è®¸ |
| nlohmann/json | MIT | âœ… å…è®¸ |
| spdlog | MIT | âœ… å…è®¸ |
| http-parser | MIT | âœ… å…è®¸ |

æ‰€æœ‰ä¾èµ–éƒ½ä½¿ç”¨å®½æ¾çš„å¼€æºè®¸å¯è¯ï¼Œå¯ç”¨äºå•†ä¸šé¡¹ç›®ã€‚

## å‚è€ƒèµ„æº

- [Asioæ•™ç¨‹](https://think-async.com/Asio/asio-1.28.0/doc/)
- [nlohmann/jsonæ–‡æ¡£](https://json.nlohmann.me/)
- [spdlog Wiki](https://github.com/gabime/spdlog/wiki)
- [CMakeæ•™ç¨‹](https://cmake.org/cmake/help/latest/guide/tutorial/)

---

**æ›´æ–°æ—¥æœŸ**: 2024-12-06
